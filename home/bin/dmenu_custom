#!/usr/bin/env python

import re
import subprocess
import sys

# Script to run dmenu with a particular theme + screen position

def define_geo(screen_width, screen_height):
    # TODO: Simplify this function. It doesn't seem to use screen_height. Also decide on what dimensions I want dmenu to have
    dw = int(screen_width * 0.2)
    dx = int((screen_width - dw) / 2)
    dy = 200 # TODO: Unused variable

    return {
        'x': str(dx),
        'y': '200',
        'w': str(dw),
        'h': '5',
    }

# Using --current allows xrandr to return 1~2 seconds quicker in multi-monitor + HiDPI situations
lines = subprocess.run(['xrandr', '--current'], stdout=subprocess.PIPE).stdout.decode('ascii').split('\n')
regex = re.compile('\d+x\d+')
for line in lines:
    # TODO: First, apply to the "primary" screen, then apply to the "eDP-1" screen, then apply to any screen available
    if 'eDP-1 connected' in line or 'default connected' in line:
        res = regex.search(line).group(0).strip().split('x')
        geo = define_geo(int(res[0]), int(res[1]))

theme = sys.argv[1] if len(sys.argv) > 1 else 'original'

css = {
    'original': ['#1B1D1E', '#80D4FF', '#333333', '#FFFFFF'],
    'bright':   ['#373B41', '#DE935F', '#81A2BE', '#000000'],
    'test':     ['#FF0000', '#00FF00', '#0000FF', '#FFFFFF']
}

subprocess.run([
    'dmenu_run',
    '-l', '8',  # Number of lines to display
    '-nb', css[theme][0], # Normal background color
    '-nf', css[theme][1], # Normal foreground color
    '-sb', css[theme][2], # Selected background color
    '-sf', css[theme][3], # Selected foreground color
    '-p', "",   # Prompt to be displayed on the left
    '-f',
    '-i',       # Case insensitive matching
    '-fn', 'Anonymous Pro:size=11', # TODO: Match the size that is in ~/.Xresources
    '-h', geo['h'],
    '-w', geo['w'],
    '-x', geo['x'],
    '-y', geo['y'],
])
